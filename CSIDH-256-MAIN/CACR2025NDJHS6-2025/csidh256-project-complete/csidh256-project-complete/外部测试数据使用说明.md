# 外部测试数据使用说明

## 概述

CSIDH-256 项目现在支持使用外部测试数据文件进行性能测评，这大大增加了测试的灵活性和普适性。你可以使用自己的测试数据，也可以使用项目提供的标准测试数据集。

## 功能特性

- ✅ **内置数据（默认）**：使用项目内置的标准测试数据
- ✅ **外部数据支持**：支持从JSON文件加载测试数据
- ✅ **多向量支持**：一个JSON文件可以包含多个测试向量
- ✅ **向量选择**：可以指定使用哪个测试向量
- ✅ **数据验证**：自动验证外部数据的有效性
- ✅ **灵活配置**：支持自定义迭代次数等参数

## 使用方法

### 1. 基本用法

#### 使用内置测试数据（默认）
```bash
performance_test_with_external.exe
```

#### 使用外部测试数据
```bash
performance_test_with_external.exe --external test_data_external.json
```

#### 使用外部数据的指定向量
```bash
performance_test_with_external.exe --external test_data_external.json --vector 2
```

#### 列出外部数据中的所有向量
```bash
performance_test_with_external.exe --external test_data_external.json --list
```

#### 自定义迭代次数
```bash
performance_test_with_external.exe --external test_data_external.json --iterations 1000000
```

### 2. 命令行参数

| 参数 | 说明 | 示例 |
|------|------|------|
| `--external <文件路径>` | 指定外部测试数据JSON文件 | `--external test_data.json` |
| `--vector <索引>` | 使用指定索引的测试向量（从1开始） | `--vector 2` |
| `--iterations <次数>` | 设置性能测试迭代次数 | `--iterations 1000000` |
| `--list` | 列出外部数据中的所有测试向量 | `--list` |
| `--help` 或 `-h` | 显示帮助信息 | `--help` |

### 3. JSON文件格式

外部测试数据文件必须是有效的JSON格式，结构如下：

```json
{
  "test_vectors": [
    {
      "test_name": "测试向量名称",
      "description": "测试向量描述",
      "category": "STANDARD|EDGE|SECURITY|PERFORMANCE|NIST",
      "input_a": {
        "limbs": [
          "0x123456789ABCDEF0",
          "0xFEDCBA9876543210",
          "0x0011223344556677",
          "0x1899AABBCCDDEEFF"
        ]
      },
      "input_b": {
        "limbs": [
          "0xAAAAAAAAAAAAAAAA",
          "0x5555555555555555",
          "0xCCCCCCCCCCCCCCCC",
          "0x1333333333333333"
        ]
      },
      "expected_result": {
        "limbs": [
          "0x0000000000000000",
          "0x0000000000000000",
          "0x0000000000000000",
          "0x0000000000000000"
        ]
      }
    }
  ]
}
```

#### 字段说明

- **test_name** (必需): 测试向量的名称
- **description** (可选): 测试向量的描述信息
- **category** (可选): 测试类别，可以是：
  - `STANDARD`: 标准测试
  - `EDGE`: 边界值测试
  - `SECURITY`: 安全测试
  - `PERFORMANCE`: 性能测试
  - `NIST`: NIST标准测试
- **input_a** (必需): 第一个输入值，包含4个64位limb（十六进制字符串）
- **input_b** (必需): 第二个输入值，包含4个64位limb（十六进制字符串）
- **expected_result** (可选): 期望结果，用于正确性验证

#### Limb格式

每个limb可以是以下格式之一：
- `"0x123456789ABCDEF0"` (带0x前缀)
- `"123456789ABCDEF0"` (不带0x前缀)

### 4. 示例文件

项目提供了一个示例外部测试数据文件：`test_data_external.json`

该文件包含以下测试向量：
1. **标准性能测试向量1** - 标准256位大整数测试
2. **边界值测试 - 最大值** - 测试最大可能值
3. **边界值测试 - 最小值** - 测试最小有效值
4. **安全测试 - 最高位设置** - 侧信道攻击检测
5. **性能测试 - 随机数据1** - 随机生成的大整数
6. **性能测试 - 随机数据2** - 另一组随机数据
7. **NIST标准测试向量** - 符合NIST标准的测试向量
8. **高负载测试向量** - 高负载场景测试

## 使用场景

### 场景1: 使用标准测试数据
适用于常规性能测试和算法对比：
```bash
performance_test_with_external.exe
```

### 场景2: 使用自定义测试数据
适用于特定场景的性能评估：
```bash
performance_test_with_external.exe --external my_custom_data.json
```

### 场景3: 批量测试多个向量
适用于全面性能评估：
```bash
# 测试向量1
performance_test_with_external.exe --external test_data.json --vector 1

# 测试向量2
performance_test_with_external.exe --external test_data.json --vector 2

# ... 依此类推
```

### 场景4: 高精度性能测试
适用于需要更高精度的性能分析：
```bash
performance_test_with_external.exe --external test_data.json --iterations 1000000
```

## 创建自定义测试数据

### 步骤1: 准备JSON文件

创建一个新的JSON文件，例如 `my_test_data.json`：

```json
{
  "test_vectors": [
    {
      "test_name": "我的自定义测试",
      "description": "用于特定场景的测试",
      "category": "PERFORMANCE",
      "input_a": {
        "limbs": [
          "0x123456789ABCDEF0",
          "0xFEDCBA9876543210",
          "0x0011223344556677",
          "0x1899AABBCCDDEEFF"
        ]
      },
      "input_b": {
        "limbs": [
          "0xAAAAAAAAAAAAAAAA",
          "0x5555555555555555",
          "0xCCCCCCCCCCCCCCCC",
          "0x1333333333333333"
        ]
      }
    }
  ]
}
```

### 步骤2: 验证JSON格式

确保JSON文件格式正确，可以使用在线JSON验证工具或以下命令：
```bash
# Windows PowerShell
Get-Content my_test_data.json | ConvertFrom-Json
```

### 步骤3: 使用自定义数据

```bash
performance_test_with_external.exe --external my_test_data.json
```

## 错误处理

### 常见错误及解决方法

1. **文件未找到**
   ```
   错误: 无法打开文件: test_data.json
   ```
   - 检查文件路径是否正确
   - 确保文件存在且可读

2. **JSON格式错误**
   ```
   错误: 未找到测试向量数组
   ```
   - 检查JSON格式是否正确
   - 确保包含 `test_vectors` 数组

3. **向量索引超出范围**
   ```
   警告: 向量索引 10 超出范围，使用第一个向量
   ```
   - 使用 `--list` 查看可用的向量索引
   - 确保索引在有效范围内

4. **数据验证失败**
   ```
   警告: 外部测试数据验证失败，使用内置数据
   ```
   - 检查测试向量是否包含必需的字段
   - 确保 `input_a` 和 `input_b` 格式正确

## 最佳实践

1. **数据组织**
   - 将相关测试向量组织在同一个JSON文件中
   - 使用有意义的测试名称和描述
   - 合理分类测试向量

2. **性能测试**
   - 对于快速测试，使用较少的迭代次数（如10,000）
   - 对于精确测试，使用大量迭代次数（如1,000,000）
   - 多次运行取平均值以获得更可靠的结果

3. **数据验证**
   - 在创建测试数据后，使用 `--list` 选项验证数据加载
   - 确保测试数据符合算法要求

4. **版本控制**
   - 将测试数据文件纳入版本控制
   - 记录测试数据的来源和用途

## 技术实现

### 数据加载流程

1. **文件读取**: 从指定路径读取JSON文件
2. **JSON解析**: 解析JSON格式，提取测试向量
3. **数据验证**: 验证测试向量的完整性和有效性
4. **内存分配**: 为测试向量分配内存
5. **数据使用**: 在性能测试中使用加载的数据

### 支持的格式

- JSON格式（UTF-8编码）
- 十六进制字符串（带或不带0x前缀）
- 大端序（Big-Endian）limb顺序

## 与内置数据的对比

| 特性 | 内置数据 | 外部数据 |
|------|---------|---------|
| 灵活性 | 固定 | 可自定义 |
| 易用性 | 开箱即用 | 需要准备文件 |
| 可扩展性 | 需修改代码 | 只需修改JSON |
| 适用场景 | 标准测试 | 特定场景测试 |
| 维护成本 | 低 | 中等 |

## 总结

外部测试数据功能为CSIDH-256项目提供了更大的灵活性和普适性：

- ✅ 支持自定义测试场景
- ✅ 无需修改代码即可使用新数据
- ✅ 便于批量测试和自动化
- ✅ 提高测试的可重复性
- ✅ 支持多种测试类别

通过合理使用外部测试数据功能，可以更全面地评估算法性能，适应不同的应用场景和需求。

---

**文档版本**: 1.0  
**最后更新**: 2025年  
**维护者**: CSIDH-256 项目组


