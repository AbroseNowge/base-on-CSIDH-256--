# å¤–éƒ¨æµ‹è¯•æ•°æ®è°ƒç”¨é€»è¾‘è¯´æ˜

## ğŸ“‹ è°ƒç”¨æµç¨‹

### 1. ç¨‹åºå¯åŠ¨å’Œå‚æ•°è§£æ

```c
int main(int argc, char* argv[]) {
    // è§£æå‘½ä»¤è¡Œå‚æ•°
    for (int i = 1; i < argc; i++) {
        if (strcmp(argv[i], "--external") == 0 && i + 1 < argc) {
            external_file = argv[++i];  // è·å–JSONæ–‡ä»¶è·¯å¾„
            use_external = true;        // æ ‡è®°ä½¿ç”¨å¤–éƒ¨æ•°æ®
        }
        // ... å…¶ä»–å‚æ•°
    }
}
```

**å…³é”®ç‚¹**ï¼š
- å¦‚æœæ²¡æœ‰ `--external` å‚æ•°ï¼Œ`use_external` ä¿æŒä¸º `false`
- ç¨‹åºä¼šé»˜è®¤ä½¿ç”¨å†…ç½®æ•°æ®

### 2. æ•°æ®åŠ è½½å†³ç­–

```c
if (use_external && external_file) {
    // å°è¯•åŠ è½½å¤–éƒ¨æ•°æ®
    if (load_external_test_data(external_file, &external_data)) {
        // åŠ è½½æˆåŠŸï¼Œä½¿ç”¨å¤–éƒ¨æ•°æ®
        test_a = &external_data.vectors[vector_index].input_a;
        test_b = &external_data.vectors[vector_index].input_b;
    } else {
        // åŠ è½½å¤±è´¥ï¼Œå›é€€åˆ°å†…ç½®æ•°æ®
        printf("è­¦å‘Š: æ— æ³•åŠ è½½å¤–éƒ¨æµ‹è¯•æ•°æ®ï¼Œä½¿ç”¨å†…ç½®æ•°æ®\n");
    }
} else {
    // æ²¡æœ‰æŒ‡å®šå¤–éƒ¨æ–‡ä»¶ï¼Œä½¿ç”¨å†…ç½®æ•°æ®
    test_a = &BUILTIN_TEST_A;
    test_b = &BUILTIN_TEST_B;
}
```

### 3. å¤–éƒ¨æ•°æ®åŠ è½½è¿‡ç¨‹

#### æ­¥éª¤1: æ‰“å¼€JSONæ–‡ä»¶
```c
FILE* file = fopen(filepath, "r");
if (!file) {
    fprintf(stderr, "é”™è¯¯: æ— æ³•æ‰“å¼€æ–‡ä»¶: %s\n", filepath);
    return false;
}
```

#### æ­¥éª¤2: è¯»å–æ–‡ä»¶å†…å®¹
```c
// è·å–æ–‡ä»¶å¤§å°
fseek(file, 0, SEEK_END);
long file_size = ftell(file);
fseek(file, 0, SEEK_SET);

// è¯»å–æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜
char* buffer = (char*)malloc(file_size + 1);
fread(buffer, 1, file_size, file);
buffer[read_size] = '\0';
```

#### æ­¥éª¤3: è§£æJSONç»“æ„
```c
// æŸ¥æ‰¾æµ‹è¯•å‘é‡æ•°ç»„
const char* vectors_start = strstr(buffer, "\"test_vectors\"");
if (!vectors_start) {
    vectors_start = strchr(buffer, '[');  // å¦‚æœæ²¡æœ‰test_vectorså­—æ®µï¼Œç›´æ¥æŸ¥æ‰¾æ•°ç»„
}
```

#### æ­¥éª¤4: è§£ææ¯ä¸ªæµ‹è¯•å‘é‡
```c
while (*current && vector_count < max_vectors) {
    if (*current == '{') {
        // æå–å•ä¸ªJSONå¯¹è±¡
        const char* obj_end = strchr(current, '}');
        // è§£æè¿™ä¸ªå¯¹è±¡
        if (parse_test_vector_from_json(obj_str, &dataset->vectors[vector_count])) {
            vector_count++;
        }
    }
}
```

#### æ­¥éª¤5: è§£ææµ‹è¯•å‘é‡å­—æ®µ
```c
bool parse_test_vector_from_json(const char* json_str, external_test_vector* vector) {
    // è§£æ test_name
    const char* name_start = strstr(json_str, "\"test_name\"");
    
    // è§£æ input_a
    const char* input_a_start = strstr(json_str, "\"input_a\"");
    parse_bigint256_from_json(input_a_start, &vector->input_a);
    
    // è§£æ input_b
    const char* input_b_start = strstr(json_str, "\"input_b\"");
    parse_bigint256_from_json(input_b_start, &vector->input_b);
    
    return true;
}
```

#### æ­¥éª¤6: è§£æå¤§æ•´æ•°ï¼ˆbigint256ï¼‰
```c
static bool parse_bigint256_from_json(const char* json_str, bigint256* result) {
    // æŸ¥æ‰¾ "limbs" å­—æ®µ
    const char* limbs_start = strstr(json_str, "\"limbs\"");
    limbs_start = strchr(limbs_start, '[');
    
    // è§£æ4ä¸ªlimbå€¼ï¼ˆåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼‰
    for (int i = 0; i < LIMBS; i++) {
        // è¯»å–åå…­è¿›åˆ¶å­—ç¬¦ä¸²
        char hex_value[32];
        // è½¬æ¢ä¸ºuint64_t
        parse_hex_string(hex_value, &result->limbs[i]);
    }
}
```

### 4. ä½¿ç”¨æ•°æ®æ‰§è¡Œæµ‹è¯•

```c
// æµ‹è¯•å‡½æ•°æ¥æ”¶æ•°æ®æŒ‡é’ˆ
void benchmark_algorithm_with_data(
    const char* name, 
    void (*func)(bigint256*, const bigint256*, const bigint256*), 
    const bigint256* test_a,  // æŒ‡å‘å¤–éƒ¨æ•°æ®æˆ–å†…ç½®æ•°æ®
    const bigint256* test_b,
    int iterations
) {
    // æ˜¾ç¤ºè¾“å…¥æ•°æ®ï¼ˆç°åœ¨å·²æ·»åŠ ï¼‰
    printf("è¾“å…¥æ•°æ®A: 0x%016llX ...\n", test_a->limbs[0], ...);
    
    // æ‰§è¡Œæµ‹è¯•
    for (int i = 0; i < iterations; i++) {
        func(&result, test_a, test_b);
    }
}
```

## ğŸ” é—®é¢˜è¯Šæ–­

### é—®é¢˜1: ä¸¤ä¸ªç¨‹åºç»“æœä¸€æ ·

**åŸå› **ï¼š
- `performance_comparison_test.exe` æ€»æ˜¯ä½¿ç”¨å†…ç½®æ•°æ®
- `performance_test_with_external.exe` å¦‚æœæ²¡æœ‰ `--external` å‚æ•°ï¼Œä¹Ÿä½¿ç”¨å†…ç½®æ•°æ®
- ä¸¤è€…ä½¿ç”¨ç›¸åŒçš„å†…ç½®æ•°æ®ï¼Œæ‰€ä»¥ç»“æœä¸€æ ·

**è§£å†³æ–¹æ³•**ï¼š
```bash
# ä½¿ç”¨å¤–éƒ¨æ•°æ®
./performance_test_with_external.exe --external test_data_external.json
```

### é—®é¢˜2: æ²¡æœ‰æ˜¾ç¤ºå¤–éƒ¨æ•°æ®ä¿¡æ¯

**åŸå› **ï¼š
- ä¹‹å‰çš„ä»£ç æ²¡æœ‰æ˜¾ç¤ºè¾“å…¥æ•°æ®
- æ— æ³•åŒºåˆ†ä½¿ç”¨çš„æ˜¯å†…ç½®æ•°æ®è¿˜æ˜¯å¤–éƒ¨æ•°æ®

**å·²ä¿®å¤**ï¼š
- ç°åœ¨ä¼šæ˜¾ç¤ºè¾“å…¥æ•°æ®Aå’Œè¾“å…¥æ•°æ®B
- ä¼šæ˜¾ç¤ºæ•°æ®æ¥æºï¼ˆå†…ç½®/å¤–éƒ¨ï¼‰
- ä¼šæ˜¾ç¤ºæµ‹è¯•å‘é‡åç§°

### é—®é¢˜3: æ¯æ¬¡ç»“æœéƒ½ä¸€æ ·

**åŸå› **ï¼š
- å¦‚æœä½¿ç”¨ç›¸åŒçš„æ•°æ®ï¼Œç»“æœåº”è¯¥ä¸€æ ·ï¼ˆè¿™æ˜¯æ­£ç¡®çš„ï¼‰
- å¦‚æœä½¿ç”¨ä¸åŒçš„å¤–éƒ¨æ•°æ®å‘é‡ï¼Œç»“æœåº”è¯¥ä¸åŒ

**éªŒè¯æ–¹æ³•**ï¼š
```bash
# ä½¿ç”¨ä¸åŒçš„å‘é‡ï¼Œç»“æœåº”è¯¥ä¸åŒ
./performance_test_with_external.exe --external test_data_external.json --vector 1
./performance_test_with_external.exe --external test_data_external.json --vector 2
```

## ğŸ“Š æ•°æ®æµå›¾

```
å‘½ä»¤è¡Œå‚æ•°
    |
    v
[è§£æå‚æ•°]
    |
    +-- æœ‰ --external? --æ˜¯--> [åŠ è½½JSONæ–‡ä»¶]
    |                              |
    |                              v
    |                          [è§£æJSON]
    |                              |
    |                              v
    |                          [æå–æµ‹è¯•å‘é‡]
    |                              |
    |                              v
    |                          [éªŒè¯æ•°æ®]
    |                              |
    |                              v
    +-- å¦/å¤±è´¥ ------------------> [ä½¿ç”¨å†…ç½®æ•°æ®]
                                        |
                                        v
                                  [æ‰§è¡Œæ€§èƒ½æµ‹è¯•]
                                        |
                                        v
                                  [æ˜¾ç¤ºç»“æœ]
```

## âœ… æ­£ç¡®ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: ä½¿ç”¨å†…ç½®æ•°æ®ï¼ˆé»˜è®¤ï¼‰
```bash
./performance_test_with_external.exe
```
**è¾“å‡º**ï¼šä¼šæ˜¾ç¤º"ä½¿ç”¨å†…ç½®æµ‹è¯•æ•°æ®"å’Œå†…ç½®æ•°æ®çš„å€¼

### æ–¹æ³•2: ä½¿ç”¨å¤–éƒ¨æ•°æ®
```bash
./performance_test_with_external.exe --external test_data_external.json
```
**è¾“å‡º**ï¼šä¼šæ˜¾ç¤º"æˆåŠŸåŠ è½½å¤–éƒ¨æµ‹è¯•æ•°æ®"å’Œå¤–éƒ¨æ•°æ®çš„å€¼

### æ–¹æ³•3: ä½¿ç”¨æŒ‡å®šå‘é‡
```bash
./performance_test_with_external.exe --external test_data_external.json --vector 2
```
**è¾“å‡º**ï¼šä¼šæ˜¾ç¤ºä½¿ç”¨ç¬¬2ä¸ªå‘é‡çš„ä¿¡æ¯

### æ–¹æ³•4: åˆ—å‡ºæ‰€æœ‰å‘é‡
```bash
./performance_test_with_external.exe --external test_data_external.json --list
```
**è¾“å‡º**ï¼šæ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„æµ‹è¯•å‘é‡

## ğŸ”§ è°ƒè¯•æŠ€å·§

### æ£€æŸ¥æ•°æ®æ˜¯å¦åŠ è½½æˆåŠŸ

ç¨‹åºç°åœ¨ä¼šæ˜¾ç¤ºï¼š
- âœ“ æˆåŠŸåŠ è½½å¤–éƒ¨æµ‹è¯•æ•°æ®
- ä½¿ç”¨æµ‹è¯•å‘é‡: [åç§°]
- è¾“å…¥æ•°æ®A: [å€¼]
- è¾“å…¥æ•°æ®B: [å€¼]

### æ£€æŸ¥æ•°æ®æ˜¯å¦ä¸åŒ

å¯¹æ¯”è¾“å‡ºä¸­çš„"è¾“å…¥æ•°æ®A"å’Œ"è¾“å…¥æ•°æ®B"ï¼š
- å¦‚æœä½¿ç”¨å†…ç½®æ•°æ®ï¼š`0x123456789ABCDEF0 ...`
- å¦‚æœä½¿ç”¨å¤–éƒ¨æ•°æ®ç¬¬ä¸€ä¸ªå‘é‡ï¼š`0x2468ACF13579BDE0 ...`ï¼ˆä¸åŒï¼ï¼‰

### æ£€æŸ¥è®¡ç®—ç»“æœ

ä¸åŒçš„è¾“å…¥æ•°æ®ä¼šäº§ç”Ÿä¸åŒçš„è®¡ç®—ç»“æœï¼ˆResult limbsï¼‰ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025å¹´  
**ç»´æŠ¤è€…**: CSIDH-256 é¡¹ç›®ç»„


